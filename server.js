const { Telegraf } = require('telegraf');
const express = require('express');
const app = express();

const bot = new Telegraf(process.env.BOT_TOKEN);

// –í–µ–±—Ö—É–∫
app.use(express.json());
app.use(bot.webhookCallback('/'));

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–ø–ª–∞–µ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ ID –±–æ—Ç–∞)
bot.on('message', async (ctx) => {
  console.log('–°–æ–æ–±—â–µ–Ω–∏–µ:', ctx.message.text); // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  const reply = ctx.message.reply_to_message;
  if (reply && reply.from.id === ctx.botInfo.id) {
    const userName = ctx.from.first_name || '–¥—Ä—É–≥';
    await ctx.reply(
      `–ü—Ä–∏–≤–µ—Ç, *${userName}*! –ß–µ–º –ø–æ–º–æ—á—å? üòä`,
      { 
        parse_mode: 'Markdown',
        reply_to_message_id: ctx.message.message_id
      }
    );
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
bot.hears(/–ø—Ä–∏–≤–µ—Ç|–±–æ—Ç|–ø–æ–º–æ—â—å/i, (ctx) => {
  const userName = ctx.from.first_name || '–¥—Ä—É–≥';
  ctx.reply(
    `*${userName}*, —è –∑–¥–µ—Å—å! üöÄ`,
    { 
      parse_mode: 'Markdown',
      reply_to_message_id: ctx.message.message_id 
    }
  );
});

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(process.env.PORT || 3000, () => {
  console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫!');
});
